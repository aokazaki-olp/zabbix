# 🧩 Template クラス 利用者向けドキュメント

このドキュメントは、Google Apps Script（V8）や通常の JavaScript 環境で利用できる **軽量テンプレートレンダラー `Template` クラス**の使い方を、利用者目線でまとめたものです ✨

---

## 📌 できること

* `{{{ }}}` 形式のプレースホルダーを文字列テンプレートとして展開
* オブジェクト / 配列の **深い参照**（`a.b.c`, `a[0]`, `a["key"]`）
* `||` による **フォールバック（優先順位付き）**
* `|` による **フィルター処理（パイプ）**
* 数値・文字列リテラルの直接指定
* フィルターの追加・拡張が可能
* テンプレートは **事前パース & キャッシュ**され高速 🚀

---

## 🚀 クイックスタート

```js
const template = `こんにちは {{{ user.name || 'ゲスト' }}} さん 👋`;

const data = {
  user: { name: '岡崎' }
};

const result = Template.render(template, data);
// => "こんにちは 岡崎 さん 👋"
```

---

## 🧱 基本構文

### プレースホルダー

```txt
{{{ expression }}}
```

* `{{ }}` ではなく **必ず `{{{ }}}`** を使用します
* 中身は「式（expression）」として評価されます

---

## 🔍 値の参照方法

### オブジェクト参照

```js
{{{ user.name }}}
```

```js
const data = { user: { name: '太郎' } };
```

---

### 配列参照

```js
{{{ items[0] }}}
```

```js
const data = { items: ['A', 'B', 'C'] };
```

---

### ブラケット記法（キーが文字列の場合）

```js
{{{ user['display-name'] }}}
```

---

## 🪜 フォールバック（ `||` ）

複数の候補を左から順に評価し、
**最初に「値があるもの」**を採用します。

```js
{{{ user.nickname || user.name || '名無し' }}}
```

評価スキップ条件：

* `undefined`
* `null`
* 空文字列 `""`

---

## 🧪 リテラル指定

### 文字列リテラル

```js
{{{ 'hello' }}}
{{{ "world" }}}
```

* シングルクォート / ダブルクォート両対応

---

### 数値リテラル

```js
{{{ 1000 }}}
{{{ -42 }}}
{{{ 3.14 }}}
```

---

## 🔧 フィルター（ `|` ）

値に対して **後処理** を行う仕組みです。

```js
{{{ price | number }}}
```

### 組み合わせも可能

```js
{{{ user.name | string | json }}}
```

---

## 🧰 標準フィルター

### `string`

```js
{{{ value | string }}}
```

* `null` / `undefined` → 空文字
* それ以外 → `String(value)`

---

### `number`

```js
{{{ 1234567 | number }}}
```

```txt
1,234,567
```

* 数値以外はそのまま返却

---

### `json`

```js
{{{ user | json }}}
```

* `JSON.stringify` を使用
* 失敗時は `{}` を返却

---

## ➕ カスタムフィルターの追加

### コンストラクタで渡す方法

```js
const tpl = new Template(template, {
  upper(v) {
    return String(v).toUpperCase();
  }
});
```

```js
{{{ user.name | upper }}}
```

---

### インスタンスに登録する方法

```js
tpl.registerFilter('lower', v => String(v).toLowerCase());
```

---

## 🔐 エスケープ（そのまま表示したい場合）

```txt
\{{{ user.name }}}
```

結果：

```txt
{{{ user.name }}}
```

* `\` の数が **奇数** のときエスケープ扱い

---

## ⚙️ 内部仕様メモ（利用者向け要点）

* テンプレートは初回に **パース** され、
  式は **正規化されたキーでキャッシュ**されます
* `eval` / `Function` は **未使用**（安全設計）
* アクセス不能なパスはすべて `undefined` 扱い
* フィルターは **左から順に適用**

---

## 🧠 向いている用途

* GAS メール本文 / Slack メッセージ生成 ✉️
* テキストベースのレポート生成 📄
* 軽量テンプレートが欲しい場面
* i18n や DSL 的テンプレート前処理

---

## ✅ まとめ

* `{{{ }}}` + `||` + `|` の最小構成で高機能
* GAS / V8 環境で安心して使える
* ロジックを持たせず **表現に集中**できるテンプレートエンジン 🎯

このクラスは「**軽く・安全に・十分強力**」を重視した設計です。
